version: 2.0

test:
    image:
        daocloud/ci-python:2.7

    services:
        - redis
        - mysql

    # using default docker-link env
    env:
        - REDIS_PASSWORD = "secret_password"
        - MYSQL_ROOT_PASSWORD: "cliff522.."
        - MYSQL_DATABASE: "apidb"
        
    install:
        - sudo apt-get update

    before_script:
        - mkdir -p /itxia
        - mv ./* /itxia
        - cd /itxia
        - pip install --upgrade pip
        - pip install -r requirements.txt

    script:
        - python manage.py runserver -h 0.0.0.0

build:
    lite_image:
        compile:
            dockerfile_path: Dockerfile
            build_dir: /
            cache: true
            
        package:
              dockerfile_path: Dockerfile.sec
              build_dir: /
              cache: true
